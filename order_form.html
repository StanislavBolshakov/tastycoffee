<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>Tasty Coffee</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    :root{
      --surface:#ffffff;
      --on-surface:#1f2937;
      --primary:#1e88e5;
      --primary-contrast:#ffffff;
      --muted:#6b7280;
      --radius:12px;
      --elev-1: 0 1px 2px rgba(16,24,40,0.05), 0 1px 3px rgba(16,24,40,0.06);
      --elev-2: 0 6px 18px rgba(16,24,40,0.08);
    }

    /* Global layout */
    html,body{height:100%;margin:0;font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;}
    body{background:#f3f4f6;color:var(--on-surface);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;}
    
    /* Container with padding for scrolling past bottom bars */
    .container{max-width:960px;margin:20px auto;padding:16px;padding-bottom: 40px;box-sizing:border-box;}

    header{display:flex;align-items:center;gap:16px;margin-bottom:18px;}
    .brand{display:flex;flex-direction:column;}
    h1{margin:0;font-size:22px;color:var(--on-surface);font-weight:700;}
    
    /* User Greeting */
    #userName { font-size: 15px; color: var(--muted); margin-bottom: 16px; font-weight: 500; }

    /* Card-like details */
    details{background:var(--surface);border-radius:var(--radius);box-shadow:var(--elev-1);overflow:hidden;margin-bottom:12px;border:1px solid rgba(16,24,40,0.04);transition:all 0.3s ease;}
    details[open]{background:rgba(30,136,229,0.02);border-color:rgba(30,136,229,0.15);}
    
    summary{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;cursor:pointer;list-style:none;font-weight:600;color:var(--on-surface);font-size:15px;transition:all 0.2s ease;}
    summary:hover{background:rgba(30,136,229,0.05);}
    
    /* Subcategory distinction - nested details */
    details > details { margin-left: 8px; margin-top: 8px; margin-bottom: 8px; border-left: 3px solid rgba(30,136,229,0.1); }
    details > details > summary { font-size: 14px; color: var(--muted); padding: 12px 16px; }
    details > details > summary:hover { background: rgba(30,136,229,0.04); color: var(--on-surface); }
    
    /* Custom marker/arrow */
    summary::-webkit-details-marker { display: none; }
    summary:after { content: "+"; font-size: 18px; color: var(--primary); font-weight: bold; }
    details[open] > summary:after { content: "‚àí"; }

    /* Details content animation */
    details[open] > div {
        animation: slideDown 0.3s ease;
    }
    
    @keyframes slideDown {
        from { opacity: 0; transform: translateY(-10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    /* Back to top button */
    #backToTop {
        position: fixed;
        bottom: 80px;
        right: 20px;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--primary), #1976d2);
        color: white;
        border: none;
        cursor: pointer;
        display: none;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 12px rgba(30,136,229,0.3);
        transition: all 0.3s ease;
        z-index: 1000;
        font-size: 24px;
    }
    #backToTop:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 16px rgba(30,136,229,0.4);
    }
    #backToTop:active {
        transform: translateY(0);
    }

    /* Product row */
    .product{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;border-top:1px solid rgba(16,24,40,0.03);gap:12px;flex-wrap:wrap;background:transparent;}
    .product:first-of-type{border-top:0;}
    .product .left{display:flex;flex-direction:column;gap:6px;min-width:0;flex:1;}
    .product h4{margin:0;font-size:15px;font-weight:600;color:var(--on-surface);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
    .product .metaSmall{color:var(--muted);font-size:13px;}

    /* Right side (Price, Grind, Buttons) */
    .product .right{
        display:flex;
        align-items:center;
        gap:12px;
        flex-shrink:0;
        min-width:160px;
        justify-content:flex-end;
        flex-wrap: wrap; 
    }
    
    .price{font-weight:700;color:var(--primary);background:linear-gradient(90deg, rgba(30,136,229,0.12), rgba(30,136,229,0.06));padding:6px 10px;border-radius:10px; white-space: nowrap;}
    .original-price{font-size:13px;color:var(--muted);text-decoration:line-through;margin-left:8px;}

    /* Grind select */
    .grind-select { margin-right: 4px; }
    .grind-select select{padding:8px 10px;border-radius:8px;border:1px solid rgba(16,24,40,0.06);background:transparent;color:var(--on-surface);font-size:13px; max-width: 160px;}

    /* Quantity */
    .quantity{display:inline-flex;align-items:center;border-radius:999px;overflow:hidden;border:1px solid rgba(16,24,40,0.06);box-shadow:var(--elev-1); background: #fff;}
    .quantity button{border:0;background:transparent;padding:8px 12px;cursor:pointer;font-weight:700;color:var(--primary); min-width: 32px;}
    .quantity span{display:inline-block;padding:6px 4px;background:transparent;min-width:24px;text-align:center;font-weight:600;}

    /* Cart & Comment */
    #cart{margin-top:18px;background:var(--surface);padding:16px;border-radius:12px;box-shadow:var(--elev-2);border:1px solid rgba(16,24,40,0.04);}
    #cart h2{margin:0 0 12px 0;font-size:16px;color:var(--on-surface);}
    .cart-item{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px dashed rgba(16,24,40,0.03);font-size:14px;color:var(--on-surface);}
    .cart-item:last-child{border-bottom:0;}

    .comment-box { margin-top: 16px; margin-bottom: 8px; }
    .comment-box label { display: block; font-size: 14px; font-weight: 600; color: var(--on-surface); margin-bottom: 6px; }
    .comment-box textarea {
        width: 100%;
        padding: 12px;
        border-radius: 8px;
        border: 1px solid rgba(16,24,40,0.1);
        background: #fbfdff;
        font-family: inherit;
        font-size: 14px;
        resize: vertical;
        box-sizing: border-box;
        color: var(--on-surface);
    }
    .comment-box textarea:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(30,136,229,0.1); }

    /* Compact Total Row */
    .total-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 16px;
        margin-bottom: 16px;
        font-size: 16px;
        font-weight: 700;
        color: var(--on-surface);
        border-top: 2px solid rgba(0,0,0,0.05);
        padding-top: 12px;
    }
    .total-value { color: var(--primary); font-size: 18px; }

    /* Buttons */
    .btn{display:block;padding:14px 16px;border-radius:10px;border:0;font-weight:700;cursor:pointer;font-size:16px; width: 100%; text-align:center;}
    #submitBtn{background:var(--primary);color:var(--primary-contrast);box-shadow:0 6px 18px rgba(30,136,229,0.12); transition: all 0.2s;}
    #submitBtn:disabled{opacity:0.5;cursor:not-allowed;box-shadow:none;background:linear-gradient(180deg,#a9c8f8,#7db5f7);color:#fff;}
    #clearBtn{background:transparent;border:1px solid rgba(16,24,40,0.06);color:var(--muted);margin-top:12px;}

    /* Footer */
    .footer { text-align: center; margin-top: 32px; color: var(--muted); font-size: 12px; opacity: 0.7; }
    .footer a { color: var(--muted); text-decoration: none; border-bottom: 1px dashed var(--muted); }

    /* Responsive */
    @media (max-width:640px){
      .product{flex-direction:column;align-items:flex-start;}
      .product .right{width:100%;justify-content:space-between;margin-top:8px;}
      .grind-select { width: 100%; order: -1; margin-bottom: 8px; }
      .grind-select select { width: 100%; max-width: none; }
      summary{padding:12px;}
    }
  </style>
</head>
<body>
  <main class="container">
    <header>
      <div class="brand">
        <h1>‚òï Tasty Coffee</h1>
      </div>
    </header>

    <div id="menuMetadata" style="display:none; background:rgba(30,136,229,0.08); color:var(--muted); padding:10px 16px; border-radius:8px; margin-bottom:16px; font-size:12px; border:1px solid rgba(30,136,229,0.1);">
      <span>üì¶ <span id="productsCount">0</span> —Ç–æ–≤–∞—Ä–æ–≤</span>
      <span style="margin-left:12px;">üè∑Ô∏è <span id="categoriesCount">0</span> –∫–∞—Ç–µ–≥–æ—Ä–∏–π</span>
      <span style="margin-left:12px;">üìÖ –û–±–Ω–æ–≤–ª–µ–Ω–æ: <span id="updatedAt">--</span></span>
    </div>

    <div id="userName"></div>

    <section id="menu"></section>

    <article id="cart" role="region" aria-label="–ö–æ—Ä–∑–∏–Ω–∞">
      <h2>üõí –í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞</h2>
      <ul id="cart_list" role="list" style="padding:0;margin:0;list-style:none;"></ul>
      
      <div class="comment-box" id="commentContainer" style="display:none;">
          <label for="orderComment">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∑–∞–∫–∞–∑—É:</label>
          <textarea id="orderComment" rows="2" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: —à–æ–∫–æ–ª–∞–¥–æ—á–µ–∫ –±—ã –µ—â–µ"></textarea>
      </div>

      <div class="total-row">
          <span>–ò—Ç–æ–≥–æ:</span>
          <span class="total-value"><span id="total">0</span> ‚ÇΩ</span>
      </div>

      <button id="submitBtn" disabled class="btn">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
      <button id="clearBtn" onclick="clearCart()" style="display:none;" class="btn">–û—á–∏—Å—Ç–∏—Ç—å</button>
    </article>

    <footer class="footer">
        –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ Stanislav Bolshakov (tg: <a href="https://t.me/delirium">@delirium</a>)
    </footer>
  </main>

  <button id="backToTop" onclick="scrollToTop()">‚Üë</button>

  <script src="app.js"></script>
</body>
</html>
